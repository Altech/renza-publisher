# 概要

対戦動画の記録〜アップロードまでの作業↓（従来）

1. 店舗でDVDにレコーディング（ない場合もある）
2. DVDからPCに適当な動画形式で取り込み
3. 対戦の境目を見つけ、機体選択部分などをカットしつつ動画編集ソフトで分割
4. ブラウザから1つずつアップロード、それぞれにサムネイルを指定

この3,4の部分の負担が大きいので、そこを自動化します。別々に作った上で一つのものとしても別個にも使えるようにする予定。

3の部分を自動化するからくりは、対戦の開始時点および終了時点で似たような場面が必ず現れるので、その部分のサンプルを1つずつユーザーから提供してもらい、そのサンプルを元に開始時点と終了時点を見つけます。ただし、終了時点の方は部分的に異なる画像になるのでマスクして比較を行なう。

## 3の部分
1. ffmpegで動画から1秒ごとの静止画を抽出
2. その中からユーザーにサンプルを3つ（開始時点、勝ったときの終了時点、負けたときの終了時点）指定してもらい、マスキングの範囲を指定してもらう。
3. そのサンプルを1で抽出した静止画と比較していき対戦の開始地点と終了地点をみつける。画像の類似度の比較にはImageMagickを利用。
4. 見つけられたらffmpegで動画を分割。さらにサムネイルとして開始から5秒後の画像を使う。

入力として、動画データ以外に場所、撮影会の開始日時（2014/10/03 15:30）、何番目のDVDかを与える。

出力として、<renza_撮影会の開始日時>ディレクトリに metadata.json（場所） , time_table.json（境目、勝敗）, vol1.m4v, vol1_thumb.jpeg ... のようになる。

## 4の部分
Youtube Data API を利用。動画を上げる以外に、メタデータを与えてやる。

- タイトル（場所、日時、No） e.g.  連ザ2対戦動画 Vol.1 at 2013年5月3日 in 秋葉原レジャーランド
  - 半覚x1 + 全角x3 <= 100 という制限がある
- タグ付け e.g. アビス, タケノ, 連ザ, 連ザ2, 対戦動画（機体とパイロットは別途動画サイトから付けられるようにする）
- 説明
  - サイトへのリンク
  - 好きな文言。
  
  入力として、3で生成されたディレクトリを与える。またYoutubeへの認証が必要。"2 3 4", "3..", "3..5" などの形で特定の動画のみアップロードすることも可能。
  
  出力はアップロードとそのビデオIDのリスト
  
# 動画形式
ffmpeg及びyoutubeが対応している動画形式ならたぶん何でも。今のところm4vは確認済み。
